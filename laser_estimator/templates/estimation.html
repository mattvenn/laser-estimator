{% extends "base.html" %}
{% block content %}
    <script type="text/javascript">
    // javascript to do the speed/length calculations
        function calculate() 
        {
            var speeds = [];
            var lengths = [];
            {% for key, value in lengths_by_colour.iteritems() %}
                var e = document.getElementById("{{ key }}");
                var speed = e.options[e.selectedIndex].value;
                speeds.push(parseInt(speed)); 
                lengths.push(parseInt({{value}})); 
            {% endfor %}
            var result = document.getElementById('result');  
            var cost = document.getElementById('cost');  
            var total_cost = document.getElementById('total_cost');  
            var total_time = 0;

            for( var i = 0; i < speeds.length; i ++)
                total_time += lengths[i] / speeds[i]; 

            result.value = Math.round(100 * total_time / 60) / 100;
            var cut_cost =  Math.round(100 * total_time * {{ cut_cost }}) / 100;
            cost.value = cut_cost;
            total_cost.value = cut_cost + {{material_cost}};

        }
        window.onload = calculate;
    </script>

    <h1>Estimation</h1>
      <p>
          material : {{ material }} (vector etch speed = {{ material.vector_etch_speed }} mm/s, cut speed = {{ material.cut_speed }})<br>
          paths found : {{ total_paths }}<br>
          total path length : {{ total_length }} px ({{ total_length_mm }} mm)<br>
          bounding box : {{ width }} x {{ height }} mm<br>
            
          <hr>
          {% for key, value in lengths_by_colour.iteritems() %}
               <svg width="20" height="20">
                 <rect width="20" height="20" style="fill:{{ key }}" />
               </svg> 
               colour {{ key }} = {{ value }} mm
                   <select id="{{ key }}" name="cut_type" onchange="calculate()"><option value="{{ material.vector_etch_speed }}">vector etch</option><option value="{{ material.cut_speed }}">cut</option></select> 
                <br>
          {% endfor %}

          <hr>

          time : <input id="result"/> min<br>
          cut cost : <input id="cost"/> £<br>
          material cost : {{ material_cost }}<br>
          total cost : <input id="total_cost"/> £<br>

          <a href="{{ url_for('index') }}">Upload a new file</a>
          <hr>
          <img src="{{ filename }}"><br>
          <hr>
      </p>
{% endblock %}
